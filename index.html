<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unlock! 5ème Avenue - Version GitHub</title>
    <!-- Chargement de React, ReactDOM et Babel via CDN -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }
        .icon-float { animation: float 2s ease-in-out infinite; }
        @keyframes collect-item { 
            0% { transform: scale(1); opacity: 1; } 
            50% { transform: scale(1.2) translateY(-10px); opacity: 0.5; } 
            100% { transform: scale(0); opacity: 0; } 
        }
        .animate-collect { animation: collect-item 0.4s forwards cubic-bezier(0.4, 0, 0.2, 1); }
        .reveal-btn { transition: all 0.2s ease; }
        .reveal-btn:active { transform: scale(0.9); }
        @keyframes slide-up { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .machine-modal-enter { animation: slide-up 0.3s ease-out; }
    </style>
</head>
<body class="bg-[#0f172a]">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        /* --- COMPOSANTS D'ICÔNES SVG --- */
        const IconClock = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-red-500"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>;
        const IconGrid = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>;
        const IconX = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>;
        const IconLightbulb = () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M9 18h6"/><path d="M10 22h4"/><path d="M12 2v1"/><path d="m5.22 5.22.71.71"/><path d="M18.07 5.22c.2.19.4.39.58.6l.71-.71"/><path d="M22 12h-1"/><path d="M3 12H2"/><path d="m18.07 18.78.71.71"/><path d="m5.22 18.78-.71.71"/><path d="M12 6a6 6 0 0 0-6 6c0 3.5 3 5.5 3 8h6c0-2.5 3-4.5 3-8a6 6 0 0 0-6-6Z"/></svg>;
        const IconPuzzle = ({color}) => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19.439 7.85c0-1.43.01-2.28-1.57-2.28-1.44 0-1.54-.74-1.54-1.14 0-2.2-2.17-2.43-3.08-2.43-1.02 0-3.24.31-3.24 2.43 0 .4-.1 1.14-1.54 1.14-1.58 0-1.57.85-1.57 2.28 0 1.44-.74 1.54-1.14 1.54-2.2 0-2.43 2.17-2.43 3.08 0 1.02.31 3.24 2.43 3.24.4 0 1.14.1 1.14 1.54 0 1.58-.85 1.57-2.28 1.57-1.43 0-2.28.01-2.28 1.57 0 1.44.74 1.54 1.14 1.54 2.2 0 2.43 2.17 2.43 3.08 0 1.02-.31 3.24-2.43 3.24"/></svg>;
        const IconSettings = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#10b981" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>;
        const IconLock = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#fbbf24" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>;
        const IconHand = () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 11V6a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v5"/><path d="M14 10V4a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v10"/><path d="M10 10.5V6a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v8"/><path d="M18 8a2 2 0 1 1 4 0v6a8 8 0 0 1-8 8h-2c-2.8 0-4.5-.86-5.99-2.34l-3.6-3.6a2 2 0 0 1 2.83-2.82L7 15"/></svg>;

        /* --- DONNÉES DU JEU --- */
        const GAME_DATA = {
            startingCards: ['intro'], 
            cards: {
                'intro': {
                    id: 'intro', type: 'grey', title: "Mission",
                    desc: "New York, 1931. Don Bailat a fait appel à vous. Vous devez voler un produit révolutionnaire à la multinationale 2M4GD CORP. Tout le matériel est planqué sur place. Rendez-vous sur la 5ème avenue !",
                    reveals: [5], 
                    fallbackImg: "https://raw.githubusercontent.com/delormenuiserie-ctrl/escape-game-unlock/main/carte%20intro%20Don%20bailat.png"
                },
                5: {
                    id: 5, type: 'grey', title: "5ème Avenue",
                    desc: "Le lieu du rendez-vous. Il pleut à verse. Le majestueux Flatiron Building se dresse devant vous au numéro 44. Inspectez minutieusement les lieux pour trouver votre équipement...",
                    hint: "Une lettre est cachée dans le décor. Si vous la trouvez, entrez-la comme un code.",
                    fallbackImg: "https://raw.githubusercontent.com/delormenuiserie-ctrl/escape-game-unlock/main/5eme%20avenu%20carte%205.png"
                },
                'F': {
                    id: 'F', type: 'grey', title: "Sacoche de Matériel",
                    desc: "Une sacoche en cuir noir déposée par votre contact. Elle contient tout le nécessaire pour l'opération.",
                    hint: "Ouvrez la sacoche (Zoom) pour prendre son contenu (cartes 8, 37, 42).",
                    reveals: [8, 37, 42], 
                    fallbackImg: "https://raw.githubusercontent.com/delormenuiserie-ctrl/escape-game-unlock/main/carte%20F%20sacoche.png"
                },
                44: {
                    id: 44, type: 'grey', title: "Fenêtre Ouverte",
                    desc: "Une fenêtre est ouverte là-haut. Trop haut pour grimper sans aide. Il vous faut un objet pour l'atteindre.",
                    reveals: [], specialIcon: 'blue', 
                    fallbackImg: "https://raw.githubusercontent.com/delormenuiserie-ctrl/escape-game-unlock/main/44%20carte%20appartement.png"
                },
                86: {
                    id: 86, type: 'grey', title: "QG 2M4GD Corp",
                    desc: "Vous êtes entré ! La pièce est plongée dans la pénombre. Vous distinguez plusieurs éléments.",
                    reveals: [11, 25, 58, 22], 
                    fallbackImg: "https://placehold.co/400x300/2d3748/FFFFFF?text=Bureau+General+(86)"
                },
                8: {
                    id: 8, type: 'red', title: "Pied-de-biche",
                    desc: "Un outil robuste pour forcer les ouvertures récalcitrantes.",
                    fallbackImg: "https://raw.githubusercontent.com/delormenuiserie-ctrl/escape-game-unlock/main/carte%208%20pied%20de%20biche.png"
                },
                15: {
                    id: 15, type: 'red', title: "Épingle",
                    desc: "Idéale pour crocheter des serrures fines.",
                    fallbackImg: "https://placehold.co/400x300/9b2c2c/FFFFFF?text=Epingle+(15)"
                },
                42: {
                    id: 42, type: 'red', title: "Grappin",
                    desc: "Une corde solide avec un crochet.",
                    fallbackImg: "https://raw.githubusercontent.com/delormenuiserie-ctrl/escape-game-unlock/main/carte%2042%20grappin.png"
                },
                37: {
                    id: 37, type: 'red', title: "Manette",
                    desc: "Une poignée isolante pour panneau électrique.",
                    fallbackImg: "https://placehold.co/400x300/e53e3e/FFFFFF?text=Manette+(37)"
                },
                11: {
                    id: 11, type: 'grey', title: "Tapis",
                    desc: "Un motif étrange : Un aigle (Serpentarius) tient un serpent dans ses serres.",
                    fallbackImg: "https://placehold.co/400x300/4a5568/FFFFFF?text=Tapis+Aigle/Serpent+(11)"
                },
                58: {
                    id: 58, type: 'blue', title: "Bibliothèque",
                    desc: "Fermée à clef. Il y a une serrure.",
                    fallbackImg: "https://placehold.co/400x300/2b6cb0/FFFFFF?text=Bibliotheque+(58)"
                },
                25: {
                    id: 25, type: 'green', title: "Porte Blindée",
                    desc: "Un digicode protège l'ouverture. Quel est le code ?",
                    hint: "Le code est lié aux animaux du tapis (11) et aux chiffres de la page (73). Ordre : Haut vers le Bas.",
                    fallbackImg: "https://placehold.co/400x300/276749/FFFFFF?text=Porte+Blindee+(25)"
                },
                141: { 
                    id: 141, type: 'green', title: "Tableau Élec (W)",
                    desc: "Additionnez les connecteurs : Bleu(+1), Rouge(+3), Jaune(+2).",
                    hint: "Utilisez la manette (37) et entrez le résultat de l'addition.",
                    fallbackImg: "https://placehold.co/400x300/2f855a/FFFFFF?text=Panneau+Elec+(141)"
                },
                22: {
                    id: 22, type: 'blue', title: "Caisse en bois",
                    desc: "Une caisse clouée. Il faut forcer.",
                    fallbackImg: "https://placehold.co/400x300/744210/FFFFFF?text=Caisse+Bois+(22)"
                },
                73: {
                    id: 73, type: 'grey', title: "Page & Note",
                    desc: "Serpentarius = 95, Serpens = 89.",
                    fallbackImg: "https://placehold.co/400x300/a0aec0/FFFFFF?text=Indices+Animaux+(73)"
                },
                43: {
                    id: 43, type: 'grey', title: "Courant Coupé",
                    desc: "L'alarme est désactivée. Le portrait n'est plus protégé.",
                    fallbackImg: "https://placehold.co/400x300/a0aec0/000000?text=Alarme+OFF+(43)"
                },
                30: {
                    id: 30, type: 'gold', title: "Jeu Unlock!",
                    desc: "Vous avez trouvé le prototype ! Mission accomplie.",
                    fallbackImg: "https://placehold.co/400x300/d69e2e/FFFFFF?text=BOITE+DE+JEU+(30)"
                }
            },
            combinations: { "15+58": 73, "37+141": 43, "8+22": 30, "42+44": 86 },
            codes: { 141: "6", 25: "9589" }
        };

        const AUTO_DISCARD_RULES = { 5: ['intro'], 86: [5, 44, 42], 73: [15, 58], 30: [8, 22] };
        const ALL_GAME_CARD_IDS = ['intro', 5, 8, 11, 15, 22, 25, 30, 37, 42, 43, 44, 52, 58, 73, 86, 88, 99, 141, 'F'];

        function App() {
            const [hand, setHand] = useState([]); 
            const [discardPile, setDiscardPile] = useState([]); 
            const [inputValue, setInputValue] = useState(""); 
            const [selectedCard, setSelectedCard] = useState(null); 
            const [zoomedCard, setZoomedCard] = useState(null);
            const [activeMachine, setActiveMachine] = useState(null); 
            const [machineCodeInput, setMachineCodeInput] = useState(""); 
            const [message, setMessage] = useState({ text: "Bienvenue Agent.", type: 'info' });
            const [time, setTime] = useState(0);
            const [penalty, setPenalty] = useState(0);
            const [showPenaltyAlert, setShowPenaltyAlert] = useState(false);
            const [gameWon, setGameWon] = useState(false);
            const [showCardTable, setShowCardTable] = useState(false); 
            const [cardHint, setCardHint] = useState(null);
            const [collectingIds, setCollectingIds] = useState([]); 

            useEffect(() => {
                const initialCards = GAME_DATA.startingCards.map(id => GAME_DATA.cards[id]).filter(Boolean);
                setHand(initialCards);
            }, []);

            useEffect(() => {
                const timer = setInterval(() => { if (!gameWon) setTime(t => t + 1); }, 1000);
                return () => clearInterval(timer);
            }, [gameWon]);

            const triggerPenalty = (minutes = 1) => {
                setPenalty(p => p + minutes);
                setShowPenaltyAlert(true);
                setTimeout(() => setShowPenaltyAlert(false), 2000);
            };

            const addCard = (id, fromZoom = false) => {
                const cardData = GAME_DATA.cards[id];
                if (hand.find(c => c.id === id) || discardPile.find(c => c.id === id)) return;
                
                if (cardData) {
                    if (fromZoom) {
                        setCollectingIds(prev => [...prev, id]);
                        setTimeout(() => setCollectingIds(prev => prev.filter(cid => cid !== id)), 400);
                    }
                    let newHand = [...hand, cardData];
                    let newDiscard = [...discardPile];
                    if (AUTO_DISCARD_RULES[id]) {
                        const toRemove = AUTO_DISCARD_RULES[id];
                        newDiscard = [...newDiscard, ...newHand.filter(c => toRemove.includes(c.id))];
                        newHand = newHand.filter(c => !toRemove.includes(c.id));
                    }
                    setHand(newHand);
                    setDiscardPile(newDiscard);
                    setMessage({ text: `Carte ${id} révélée.`, type: 'success' });
                    if (!fromZoom || id === 5) setZoomedCard(null);
                } else {
                    setMessage({ text: `Carte ${id} introuvable.`, type: 'error' });
                    triggerPenalty(1);
                }
            };

            const discardCard = (id) => {
                const card = hand.find(c => c.id === id);
                if (!card) return;
                setHand(prev => prev.filter(c => c.id !== id));
                setDiscardPile(prev => [...prev, card]);
            };

            const solveMachine = (machine, codeEntered) => {
                if (codeEntered === GAME_DATA.codes[machine.id]) {
                    discardCard(machine.id);
                    if (machine.id === 141) addCard(43);
                    else if (machine.id === 25) addCard(22);
                    setActiveMachine(null);
                    setMachineCodeInput("");
                } else {
                    setMessage({ text: "Code incorrect !", type: 'error' });
                    triggerPenalty(1);
                    setMachineCodeInput("");
                }
            };

            const attemptCombine = (id1, id2) => {
                const sortedKeys = [id1, id2].sort((a, b) => {
                    const nA = parseInt(a), nB = parseInt(b);
                    return (!isNaN(nA) && !isNaN(nB)) ? nA - nB : String(a).localeCompare(String(b));
                }).join('+');

                if (GAME_DATA.combinations[sortedKeys]) {
                    const resId = GAME_DATA.combinations[sortedKeys];
                    discardCard(id1); discardCard(id2);
                    addCard(resId);
                    if (resId === 30) setGameWon(true);
                } else {
                    setMessage({ text: `Rien ne se passe (${id1}+${id2})`, type: 'error' });
                    triggerPenalty(1);
                }
                setSelectedCard(null);
            };

            const getCardTextColor = (type) => {
                switch(type) {
                    case 'red': return 'text-red-400';
                    case 'blue': return 'text-blue-400';
                    case 'green': return 'text-emerald-400';
                    case 'gold': return 'text-yellow-400';
                    default: return 'text-slate-400';
                }
            };

            const minutes = Math.floor((time + penalty * 60) / 60);
            const seconds = (time + penalty * 60) % 60;
            const timeDisplay = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;

            return (
                <div className="min-h-screen text-slate-300 p-2 font-sans flex flex-col items-center relative overflow-hidden">
                    {showPenaltyAlert && (
                        <div className="fixed inset-0 z-[200] flex items-center justify-center bg-red-900/60 backdrop-blur-sm">
                            <div className="bg-red-600 text-white p-6 rounded-2xl shadow-2xl border-4 border-red-400 animate-bounce font-bold">PÉNALITÉ +1 MIN</div>
                        </div>
                    )}

                    <div className="w-full max-w-6xl bg-slate-900/90 p-3 rounded-xl shadow-lg border border-slate-700 flex items-center gap-3 mb-4 sticky top-1 z-50">
                        <div className="flex items-center gap-2 bg-black/40 px-3 py-2 rounded-lg border border-slate-700 shrink-0">
                             <IconClock />
                             <span className="text-xl font-mono font-bold text-white">{timeDisplay}</span>
                        </div>
                        <div className={`flex-grow py-2 px-4 rounded text-center text-sm font-bold shadow transition-colors ${message.type === 'error' ? 'bg-red-900/50 text-red-200' : message.type === 'success' ? 'bg-emerald-900/50 text-emerald-200' : 'bg-blue-900/30 text-blue-200'}`}>
                            {message.text}
                        </div>
                        <button onClick={() => setShowCardTable(true)} className="bg-blue-900/50 p-2 rounded-lg border border-blue-700 text-blue-200 hover:bg-blue-800"><IconGrid /></button>
                        <form onSubmit={(e) => { e.preventDefault(); const val = inputValue.trim().toUpperCase(); if (val === 'F') addCard('F'); else if (GAME_DATA.cards[val]) addCard(val); else triggerPenalty(1); setInputValue(""); }} className="flex shrink-0">
                            <input value={inputValue} onChange={e => setInputValue(e.target.value)} placeholder="Code..." className="w-20 bg-black/50 border border-slate-600 rounded-l-lg px-2 text-white outline-none focus:border-red-500" />
                            <button type="submit" className="bg-red-700 px-3 rounded-r-lg font-bold hover:bg-red-600">OK</button>
                        </form>
                    </div>

                    <div className="w-full max-w-6xl grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 pb-20">
                        {hand.map(card => (
                            <div key={card.id} className={`bg-slate-900 border-2 rounded-lg overflow-hidden transition-all ${selectedCard === card.id ? 'ring-4 ring-yellow-500 border-yellow-500 scale-105 z-10' : 'border-slate-700 shadow-xl'}`}>
                                <div className="aspect-[4/3] cursor-pointer" onClick={() => (selectedCard && selectedCard !== card.id) ? attemptCombine(selectedCard, card.id) : setZoomedCard(card)}>
                                    <img src={card.fallbackImg} className="w-full h-full object-cover" onError={(e) => { e.target.src = 'https://placehold.co/400x300/333/FFF?text=Image+Manquante'; }} />
                                </div>
                                <div className="p-2">
                                    <h3 className="text-xs font-bold uppercase truncate">{card.title}</h3>
                                    <div className="flex border-t border-slate-700 mt-2">
                                        <button onClick={() => setCardHint(card)} className="w-1/2 py-2 hover:bg-yellow-900/20 text-yellow-500 flex justify-center"><IconLightbulb /></button>
                                        <button onClick={() => card.type === 'green' ? setActiveMachine(card) : setSelectedCard(selectedCard === card.id ? null : card.id)} className={`w-1/2 py-2 flex justify-center ${selectedCard === card.id ? 'bg-yellow-600 text-black' : 'hover:bg-slate-700'}`}>
                                            {card.type === 'red' ? <IconPuzzle color="red" /> : card.type === 'blue' || card.specialIcon === 'blue' ? <IconPuzzle color="blue" /> : card.type === 'green' ? <IconSettings /> : card.type === 'gold' ? <IconLock /> : null}
                                        </button>
                                    </div>
                                </div>
                            </div>
                        ))}
                    </div>

                    {zoomedCard && (
                        <div className="fixed inset-0 z-[100] bg-black/95 flex items-center justify-center p-4" onClick={() => setZoomedCard(null)}>
                            <div className="max-w-4xl w-full bg-slate-900 rounded-xl overflow-hidden border border-slate-700 relative" onClick={e => e.stopPropagation()}>
                                <button onClick={() => setZoomedCard(null)} className="absolute top-4 right-4 bg-black/50 p-2 rounded-full hover:bg-red-600 transition-colors text-white"><IconX /></button>
                                <img src={zoomedCard.fallbackImg} className="max-h-[60vh] mx-auto object-contain" />
                                <div className="p-6 bg-slate-800 text-center">
                                    <h2 className="text-2xl font-bold mb-2 text-white">{zoomedCard.title}</h2>
                                    <p className="text-slate-400 mb-6">{zoomedCard.desc}</p>
                                    <div className="flex flex-wrap gap-2 justify-center">
                                        {zoomedCard.reveals?.filter(id => !hand.some(c=>c.id===id) && !discardPile.some(c=>c.id===id)).map(id => (
                                            <button key={id} onClick={() => addCard(id, true)} className={`reveal-btn bg-slate-700 border-2 border-slate-500 px-6 py-2 rounded-lg font-bold flex items-center gap-2 text-white ${collectingIds.includes(id) ? 'animate-collect opacity-0' : 'hover:bg-slate-600'}`}><IconHand /> {id === 5 ? "Lancer l'Aventure" : `Prendre ${id}`}</button>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {activeMachine && (
                        <div className="fixed inset-0 z-[150] bg-black/80 flex items-center justify-center p-4" onClick={() => setActiveMachine(null)}>
                            <div className="bg-slate-900 border-2 border-emerald-500 rounded-2xl p-6 max-w-sm w-full machine-modal-enter shadow-2xl" onClick={e => e.stopPropagation()}>
                                <h3 className="text-emerald-400 font-bold uppercase mb-4 flex items-center gap-2"><IconSettings /> Machine {activeMachine.id}</h3>
                                <input autoFocus value={machineCodeInput} onChange={e => setMachineCodeInput(e.target.value.replace(/\D/g,'').slice(0,4))} placeholder="----" className="w-full bg-black border-2 border-slate-700 rounded-xl p-4 text-center text-4xl font-mono text-emerald-500 outline-none mb-6" />
                                <div className="grid grid-cols-2 gap-3">
                                    <button onClick={() => setActiveMachine(null)} className="py-2 bg-slate-800 rounded-lg font-bold hover:bg-slate-700">Annuler</button>
                                    <button onClick={() => solveMachine(activeMachine, machineCodeInput)} className="py-2 bg-emerald-600 text-black font-bold rounded-lg shadow-lg hover:bg-emerald-500 transition-colors">Valider</button>
                                </div>
                            </div>
                        </div>
                    )}

                    {showCardTable && (
                        <div className="fixed inset-0 z-[120] bg-black/90 p-4 overflow-y-auto" onClick={() => setShowCardTable(false)}>
                            <div className="max-w-5xl mx-auto bg-slate-900 rounded-2xl p-6 border border-slate-700" onClick={e => e.stopPropagation()}>
                                <div className="flex justify-between mb-6 items-center">
                                    <h2 className="text-xl font-bold text-white">Tableau des Cartes</h2>
                                    <button onClick={() => setShowCardTable(false)} className="text-slate-400 hover:text-white"><IconX /></button>
                                </div>
                                <div className="grid grid-cols-3 sm:grid-cols-5 md:grid-cols-8 gap-4">
                                    {ALL_GAME_CARD_IDS.map(id => {
                                        const c = hand.find(x=>x.id===id) || discardPile.find(x=>x.id===id);
                                        const originalCard = GAME_DATA.cards[id];
                                        return (
                                            <div key={id} className={`aspect-[2/3] border-2 rounded-lg flex items-center justify-center relative overflow-hidden ${c ? 'border-slate-500' : 'border-slate-800 opacity-40'}`}>
                                                {c && originalCard ? <img src={originalCard.fallbackImg} className="absolute inset-0 w-full h-full object-cover opacity-60" /> : null}
                                                <span className={`font-black z-10 ${c ? getCardTextColor(originalCard?.type) : 'text-slate-700'}`}>{id === 'intro' ? 'I' : id}</span>
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                        </div>
                    )}

                    {cardHint && (
                        <div className="fixed inset-0 z-[200] bg-black/80 flex items-center justify-center p-4" onClick={() => setCardHint(null)}>
                            <div className="bg-yellow-900/90 border-2 border-yellow-500 p-6 rounded-xl max-w-sm w-full shadow-2xl" onClick={e=>e.stopPropagation()}>
                                <h3 className="font-bold text-yellow-400 mb-2 uppercase">Indice {cardHint.id}</h3>
                                <p className="text-lg text-yellow-100">{cardHint.hint || "Analysez bien les cartes environnantes."}</p>
                                <button onClick={() => setCardHint(null)} className="mt-4 w-full py-2 bg-yellow-600 text-black font-bold rounded hover:bg-yellow-500 transition-colors">Fermer</button>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
