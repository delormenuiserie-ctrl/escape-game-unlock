<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Unlock! 5ème Avenue</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #020617; color: #cbd5e1; -webkit-tap-highlight-color: transparent; overflow-x: hidden; font-family: system-ui, -apple-system, sans-serif; }
        
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        @keyframes slideDown { from { transform: translateY(0); } to { transform: translateY(100%); } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        .animate-slide-up { animation: slideUp 0.3s ease-out forwards; }
        .animate-slide-down { animation: slideDown 0.3s ease-in forwards; }
        .animate-fade-in { animation: fadeIn 0.3s ease-out forwards; }

        .card-ratio { aspect-ratio: 2 / 3; }

        .selected-card {
            border-color: #eab308 !important;
            box-shadow: 0 0 25px rgba(234, 179, 8, 0.5);
            transform: scale(1.02);
            z-index: 20;
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        .floating-btn {
            background: rgba(15, 23, 42, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        /* --- ICONES SVG --- */
        const IconClock = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#ef4444" strokeWidth="2.5"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>;
        const IconGrid = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>;
        const IconX = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>;
        const IconLightbulb = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5"><path d="M9 18h6"/><path d="M10 22h4"/><path d="M12 2v1"/><path d="M12 6a6 6 0 0 0-6 6c0 3.5 3 5.5 3 8h6c0-2.5 3-4.5 3-8a6 6 0 0 0-6-6Z"/></svg>;
        const IconSettings = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1-2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>;
        const IconHand = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5"><path d="M18 11V6a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v5"/><path d="M14 10V4a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v10"/><path d="M10 10.5V6a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v8"/><path d="M18 8a2 2 0 1 1 4 0v6a8 8 0 0 1-8 8h-2c-2.8 0-4.5-.86-5.99-2.34l-3.6-3.6a2 2 0 0 1 2.83-2.82L7 15"/></svg>;

        const IconPuzzleMale = () => (
            <svg width="22" height="22" viewBox="0 0 24 24" fill="#f87171">
                <path d="M6 4h8a1 1 0 0 1 1 1v2.5a2.5 2.5 0 0 0 0 5V19a1 1 0 0 1-1 1H6a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1z" />
                <circle cx="15.5" cy="11.5" r="3.5" />
            </svg>
        );

        const IconPuzzleFemale = () => (
            <svg width="22" height="22" viewBox="0 0 24 24" fill="#60a5fa">
                <path d="M4 5a1 1 0 0 1 1-1h14a1 1 0 0 1 1 1v14a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1V5z" />
                <circle cx="4.5" cy="11.5" r="3.5" fill="#020617" />
            </svg>
        );

        /* --- SCÉNARIO --- */
        const GAME_DATA = {
            cards: {
                'intro': { id: 'intro', type: 'grey', title: "Mission", desc: "1931. Infiltrez le siège de la 2M4GD Corp et volez le prototype.", reveals: [5], fallbackImg: "https://raw.githubusercontent.com/delormenuiserie-ctrl/escape-game-unlock/main/carte%20intro%20Don%20bailat.png" },
                5: { id: 5, type: 'grey', title: "5ème Avenue", desc: "Le Flatiron Building (numéro 44) est devant vous. Fouillez les alentours.", hint: "Tapez 'F' pour la sacoche.", fallbackImg: "https://raw.githubusercontent.com/delormenuiserie-ctrl/escape-game-unlock/main/5eme%20avenu%20carte%205.png" },
                'F': { id: 'F', type: 'grey', title: "Sacoche", desc: "Matériel d'effraction récupéré.", reveals: [8, 37, 42], fallbackImg: "https://raw.githubusercontent.com/delormenuiserie-ctrl/escape-game-unlock/main/carte%20F%20sacoche.png" },
                44: { id: 44, type: 'blue', title: "Fenêtre Haute", desc: "Ouverte à l'étage... Il faut de quoi grimper.", fallbackImg: "https://raw.githubusercontent.com/delormenuiserie-ctrl/escape-game-unlock/main/44%20carte%20appartement.png" },
                86: { id: 86, type: 'grey', title: "Le Bureau", desc: "Luxueux. Cherchez la chambre forte.", reveals: [11, 25, 58, 141], fallbackImg: "https://raw.githubusercontent.com/delormenuiserie-ctrl/escape-game-unlock/main/carte%2086%20reptembre%20test.png" },
                8: { id: 8, type: 'red', title: "Pied-de-biche", desc: "Outil en métal.", fallbackImg: "https://raw.githubusercontent.com/delormenuiserie-ctrl/escape-game-unlock/main/carte%208%20pied%20de%20biche.png" },
                15: { id: 15, type: 'red', title: "Épingle", desc: "Pour les serrures.", fallbackImg: "https://placehold.co/300/450/991b1b/FFFFFF?text=Epingle+15" },
                42: { id: 42, type: 'red', title: "Grappin", desc: "Corde et crochet.", fallbackImg: "https://raw.githubusercontent.com/delormenuiserie-ctrl/escape-game-unlock/main/carte%2042%20grappin.png" },
                37: { id: 37, type: 'red', title: "Manette", desc: "Levier.", fallbackImg: "https://raw.githubusercontent.com/delormenuiserie-ctrl/escape-game-unlock/main/carte%2037%20la%20manette.png" },
                11: { id: 11, type: 'grey', title: "Tapis", desc: "Motif animalier.", hint: "Aigle(95) + Serpent(89).", fallbackImg: "https://placehold.co/300/450/334155/FFFFFF?text=Tapis+11" },
                58: { id: 58, type: 'blue', title: "Bibliothèque", desc: "Verrouillée.", fallbackImg: "https://placehold.co/300/450/1e40af/FFFFFF?text=Biblio+58" },
                25: { id: 25, type: 'grey', title: "Portrait", desc: "Don Robinio.", hint: "Tapez 'R' ici.", fallbackImg: "https://raw.githubusercontent.com/delormenuiserie-ctrl/escape-game-unlock/main/carte%2025%20don%20robinio.png" },
                141: { id: 141, type: 'green', title: "Tableau W", desc: "Alarme.", fallbackImg: "https://placehold.co/300/450/065f46/FFFFFF?text=Machine+141" },
                'R': { id: 'R', type: 'green', title: "Coffre-fort", desc: "Code 4 chiffres.", fallbackImg: "https://placehold.co/300/450/065f46/FFFFFF?text=Porte+Coffre+R" },
                22: { id: 22, type: 'blue', title: "Caisse", desc: "Dans le coffre.", fallbackImg: "https://placehold.co/300/450/1e40af/FFFFFF?text=Caisse+22" },
                73: { id: 73, type: 'grey', title: "Note Index", desc: "Page 95 / 89.", fallbackImg: "https://placehold.co/300/450/475569/FFFFFF?text=Indice+73" },
                30: { id: 30, type: 'gold', title: "Prototype", desc: "MISSION RÉUSSIE !", fallbackImg: "https://placehold.co/300/450/854d0e/FFFFFF?text=VICTOIRE" }
            },
            combinations: { "15+58": 73, "37+141": 43, "8+22": 30, "42+44": 86 },
            codes: { 141: "6", 'R': "9589" }
        };

        const AUTO_DISCARD = { 5: ['intro'], 86: [5, 44, 42, 'F'], 73: [15, 58], 30: [8, 22] };
        const ALL_IDS = ['intro', 5, 8, 11, 15, 22, 25, 30, 37, 42, 58, 73, 86, 141, 'F', 'R'];

        function App() {
            const [hand, setHand] = useState([]);
            const [discardPile, setDiscardPile] = useState([]);
            const [selectedId, setSelectedId] = useState(null);
            const [inputValue, setInputValue] = useState("");
            const [zoomedCard, setZoomedCard] = useState(null);
            const [showZoomInfo, setShowZoomInfo] = useState(true);
            const [activeMachine, setActiveMachine] = useState(null);
            const [machineCode, setMachineCode] = useState("");
            const [msg, setMsg] = useState({ t: "Agent, à vous de jouer.", s: 'info' });
            const [time, setTime] = useState(0);
            const [penalty, setPenalty] = useState(0);
            const [showArchive, setShowArchive] = useState(false);

            useEffect(() => {
                setHand([GAME_DATA.cards['intro']]);
                const timer = setInterval(() => setTime(prev => prev + 1), 1000);
                return () => clearInterval(timer);
            }, []);

            const addCard = (id) => {
                const card = GAME_DATA.cards[id];
                if (!card || hand.some(c => c.id === id) || discardPile.some(c => c.id === id)) return;
                
                let nextHand = [...hand, card];
                let nextDiscard = [...discardPile];
                if (AUTO_DISCARD[id]) {
                    const toDiscard = AUTO_DISCARD[id];
                    nextDiscard = [...nextDiscard, ...nextHand.filter(c => toDiscard.includes(c.id))];
                    nextHand = nextHand.filter(c => !toDiscard.includes(c.id));
                }
                setHand(nextHand);
                setDiscardPile(nextDiscard);
                setMsg({ t: `Carte ${id} obtenue.`, s: 'success' });
            };

            const solveMachine = (machine, code) => {
                if (code === GAME_DATA.codes[machine.id]) {
                    setHand(prev => prev.filter(c => c.id !== machine.id));
                    setDiscardPile(prev => [...prev, machine]);
                    if (machine.id === 'R') addCard(22);
                    else if (machine.id === 141) addCard(43);
                    setActiveMachine(null);
                    setMachineCode("");
                    setMsg({ t: "Validé.", s: 'success' });
                } else {
                    setMsg({ t: "Code faux !", s: 'error' });
                    setPenalty(p => p + 1);
                    setMachineCode("");
                }
            };

            const combine = (id1, id2) => {
                const key = [id1, id2].sort((a,b) => String(a).localeCompare(String(b))).join('+');
                const result = GAME_DATA.combinations[key];
                if (result) {
                    const h = hand.filter(c => c.id !== id1 && c.id !== id2);
                    const d = [...discardPile, hand.find(c => c.id === id1), hand.find(c => c.id === id2)];
                    setHand(h); setDiscardPile(d); addCard(result);
                    setMsg({ t: "Réussite !", s: 'success' });
                } else {
                    setMsg({ t: "Rien ne se passe...", s: 'error' });
                    setPenalty(p => p + 1);
                }
                setSelectedId(null);
            };

            const formatTime = () => {
                const total = time + penalty * 60;
                const m = Math.floor(total / 60).toString().padStart(2, '0');
                const s = (total % 60).toString().padStart(2, '0');
                return `${m}:${s}`;
            };

            return (
                <div className="flex flex-col items-center min-h-screen w-full select-none">
                    
                    {/* STATUT HEADER */}
                    <div className="w-full max-w-lg bg-slate-900/90 backdrop-blur-md p-3 rounded-2xl border border-slate-700 flex items-center gap-3 sticky top-2 z-50 mb-6 shadow-xl mx-2">
                        <div className="flex items-center gap-2 bg-black/40 px-3 py-1.5 rounded-xl border border-slate-800 shrink-0 shadow-inner">
                            <IconClock /> <span className="font-mono font-bold text-white text-lg">{formatTime()}</span>
                        </div>
                        <div className={`flex-grow text-center text-[10px] font-black uppercase tracking-tighter py-2 px-1 rounded-xl border transition-all ${msg.s === 'error' ? 'text-red-400 border-red-900/50 bg-red-950/20' : msg.s === 'success' ? 'text-emerald-400 border-emerald-900/50 bg-emerald-950/20' : 'text-blue-400 border-blue-900/50 bg-blue-950/20'}`}>
                            {msg.t}
                        </div>
                        <button onClick={() => setShowArchive(true)} className="p-2 bg-slate-800 rounded-xl border border-slate-700 active:scale-95"><IconGrid/></button>
                        <form onSubmit={(e) => { 
                            e.preventDefault(); 
                            const v = inputValue.toUpperCase(); 
                            if(v==='F') addCard('F'); 
                            else if(v==='R' && (hand.some(c=>c.id===86)||discardPile.some(c=>c.id===86))) addCard('R');
                            else if(GAME_DATA.cards[v]) addCard(v); 
                            else { setPenalty(p=>p+1); setMsg({t:"INCONNU", s:'error'}); }
                            setInputValue(""); 
                        }} className="flex">
                            <input value={inputValue} onChange={e => setInputValue(e.target.value)} placeholder="CODE" className="w-14 bg-black border border-slate-700 rounded-l-xl p-1.5 text-white outline-none focus:border-blue-500 font-bold text-center text-sm uppercase"/>
                            <button className="bg-red-700 px-2 rounded-r-xl font-black text-[10px] uppercase">Ok</button>
                        </form>
                    </div>

                    {/* MAIN GRID */}
                    <div className="grid grid-cols-2 sm:grid-cols-3 gap-4 w-full max-w-lg px-3 pb-24">
                        {hand.map(c => {
                            const isRed = c.type === 'red';
                            const isBlue = c.type === 'blue' || c.id === 44;
                            const isGreen = c.type === 'green';
                            return (
                                <div key={c.id} className={`group relative card-ratio bg-slate-900 border-2 rounded-[1.5rem] overflow-hidden shadow-lg card-entry transition-all ${selectedId === c.id ? 'selected-card' : 'border-slate-800'}`}>
                                    
                                    <div className="w-full h-full cursor-pointer relative" onClick={() => { setZoomedCard(c); setShowZoomInfo(true); }}>
                                        <img src={c.fallbackImg} className="w-full h-full object-cover" alt="" />
                                        
                                        {c.id !== 'intro' && (
                                            <div className="absolute top-0 right-0 bg-black/80 backdrop-blur-sm px-3 py-1 font-black text-white rounded-bl-2xl border-l border-b border-white/10 text-xs">
                                                {c.id}
                                            </div>
                                        )}

                                        <div className="absolute bottom-2 left-0 right-0 flex justify-between px-2 gap-2">
                                            <button onClick={(e) => { e.stopPropagation(); setMsg({t: c.hint || "Analysez l'image.", s:'info'}); }} className="w-9 h-9 floating-btn text-yellow-500 rounded-full flex items-center justify-center shadow-lg"><IconLightbulb /></button>
                                            {(isRed || isBlue || isGreen) && (
                                                <button onClick={(e) => { 
                                                    e.stopPropagation(); 
                                                    if (isGreen) setActiveMachine(c); 
                                                    else if (selectedId === null) setSelectedId(c.id);
                                                    else if (selectedId === c.id) setSelectedId(null);
                                                    else combine(selectedId, c.id);
                                                }} className={`w-9 h-9 floating-btn rounded-full flex items-center justify-center shadow-lg ${selectedId === c.id ? 'bg-yellow-500 text-black border-yellow-400' : 'text-white'}`}>
                                                    {isRed ? <IconPuzzleMale /> : isBlue ? <IconPuzzleFemale /> : <IconSettings />}
                                                </button>
                                            )}
                                        </div>
                                    </div>
                                </div>
                            );
                        })}
                    </div>

                    {/* FULL SCREEN ZOOM SMARTPHONE */}
                    {zoomedCard && (
                        <div className="fixed inset-0 z-[100] bg-black flex flex-col items-center justify-center animate-fade-in" onClick={() => setShowZoomInfo(!showZoomInfo)}>
                            
                            <img src={zoomedCard.fallbackImg} className="h-full w-full object-contain" />
                            
                            <button onClick={(e) => { e.stopPropagation(); setZoomedCard(null); }} className="absolute top-6 right-6 bg-black/40 backdrop-blur-md p-3 rounded-full text-white z-[110] border border-white/10"><IconX/></button>

                            {/* BANDEAU INFO ESCAMOTABLE */}
                            {showZoomInfo && (
                                <div className="absolute bottom-0 left-0 right-0 bg-slate-950/90 backdrop-blur-xl border-t border-slate-800 p-6 rounded-t-[2.5rem] shadow-2xl animate-slide-up" onClick={e => e.stopPropagation()}>
                                    <div className="w-12 h-1 bg-slate-700 rounded-full mx-auto mb-6" onClick={() => setShowZoomInfo(false)}></div>
                                    <h2 className="text-2xl font-black mb-1 uppercase tracking-tighter text-white border-b border-slate-800 pb-3 inline-block">{zoomedCard.title}</h2>
                                    <p className="text-slate-400 text-base mb-8 leading-snug">{zoomedCard.desc}</p>
                                    
                                    <div className="flex flex-col gap-3 w-full">
                                        {zoomedCard.reveals && zoomedCard.reveals.map(id => {
                                            const active = hand.some(c=>c.id===id) || discardPile.some(c=>c.id===id);
                                            if (active) return null;
                                            return (
                                                <button key={id} onClick={() => { addCard(id); setZoomedCard(null); }} className="w-full py-5 rounded-2xl font-black bg-blue-600 text-white shadow-xl flex items-center justify-center gap-3 uppercase tracking-widest text-sm">
                                                    <IconHand /> {id === 5 ? "Lancer l'Aventure" : `Prendre carte ${id}`}
                                                </button>
                                            );
                                        })}
                                        <button onClick={() => setShowZoomInfo(false)} className="w-full py-4 text-slate-500 font-bold uppercase text-[10px] tracking-widest">Masquer les infos</button>
                                    </div>
                                </div>
                            )}

                            {!showZoomInfo && (
                                <button onClick={() => setShowZoomInfo(true)} className="absolute bottom-10 bg-slate-900/80 backdrop-blur-md px-6 py-3 rounded-full border border-slate-700 text-xs font-black uppercase tracking-widest text-white animate-fade-in shadow-2xl">Afficher Infos</button>
                            )}
                        </div>
                    )}

                    {/* MACHINE MODAL */}
                    {activeMachine && (
                        <div className="fixed inset-0 z-[150] bg-black/90 flex items-center justify-center p-4" onClick={() => setActiveMachine(null)}>
                            <div className="bg-slate-900 border-2 border-emerald-500 p-8 rounded-[3rem] max-w-xs w-full shadow-2xl" onClick={e=>e.stopPropagation()}>
                                <h3 className="text-emerald-400 font-black mb-6 flex items-center gap-3 uppercase text-center justify-center text-xl"><IconSettings/> Machine {activeMachine.id}</h3>
                                <input autoFocus value={machineCode} onChange={e => setMachineCode(e.target.value.replace(/\D/g,'').slice(0,4))} 
                                       onKeyDown={e => e.key === 'Enter' && solveMachine(activeMachine, machineCode)}
                                       placeholder="----" className="w-full bg-black/60 border border-slate-800 rounded-2xl p-6 mb-10 text-center text-5xl font-mono text-emerald-500 outline-none tracking-[10px]" />
                                <div className="grid grid-cols-2 gap-4">
                                    <button onClick={() => setActiveMachine(null)} className="py-4 bg-slate-800 rounded-2xl font-bold text-slate-500 uppercase text-xs">Annuler</button>
                                    <button onClick={() => solveMachine(activeMachine, machineCode)} className="py-4 bg-emerald-600 text-black rounded-2xl font-black shadow-lg uppercase text-xs">Valider</button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* ARCHIVES */}
                    {showArchive && (
                        <div className="fixed inset-0 z-[200] bg-black/98 p-4 overflow-y-auto no-scrollbar" onClick={() => setShowArchive(false)}>
                            <div className="max-w-xl mx-auto bg-slate-900 rounded-[2.5rem] p-8 border border-slate-700 relative shadow-2xl" onClick={e=>e.stopPropagation()}>
                                <div className="flex justify-between items-center mb-8">
                                    <h2 className="text-2xl font-black uppercase text-white tracking-tighter">Historique</h2>
                                    <button onClick={() => setShowArchive(false)} className="p-2 hover:bg-slate-800 rounded-full"><IconX/></button>
                                </div>
                                <div className="grid grid-cols-3 gap-4">
                                    {ALL_IDS.map(id => {
                                        const inH = hand.find(x=>x.id===id);
                                        const inD = discardPile.find(x=>x.id===id);
                                        const card = GAME_DATA.cards[id];
                                        return (
                                            <div key={id} className={`aspect-[2/3] border-2 rounded-2xl flex items-center justify-center relative overflow-hidden ${inH ? 'border-blue-500 bg-slate-800' : inD ? 'border-red-900 bg-black/40 opacity-40' : 'border-slate-800 opacity-5'}`}>
                                                {(inH || inD) && card && <img src={card.fallbackImg} className="absolute inset-0 w-full h-full object-cover opacity-20 grayscale" />}
                                                <span className="font-black z-10 text-white text-lg">{id==='intro'?'I':id}</span>
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
